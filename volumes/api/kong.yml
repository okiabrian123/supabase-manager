_format_version: "1.1"

###
### Consumers / Users
###
consumers:
  - username: "anonymous"
    keyauth_credentials:
      - key: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0"
  - username: "service_role"
    keyauth_credentials:
      - key: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImV4cCI6MTk4MzgxMjk5Nn0.EGIM96RAZx35lJzdJsyH-qQwv8Hdp7fsn3W0YpN81IU"

###
### Access Control List
###
acls:
  - consumer: "anonymous"
    group: "anon"
  - consumer: "service_role"
    group: "admin"

###
### Services & Routes
###
services:
  ## Open Auth routes
  - name: "auth-v1-open"
    url: "http://auth:9999/verify"
    routes:
      - name: "auth-v1-open"
        strip_path: true
        paths:
          - "/auth/v1/verify"
    plugins:
      - name: "cors"
  - name: "auth-v1-open-callback"
    url: "http://auth:9999/callback"
    routes:
      - name: "auth-v1-open-callback"
        strip_path: true
        paths:
          - "/auth/v1/callback"
    plugins:
      - name: "cors"
  - name: "auth-v1-open-authorize"
    url: "http://auth:9999/authorize"
    routes:
      - name: "auth-v1-open-authorize"
        strip_path: true
        paths:
          - "/auth/v1/authorize"
    plugins:
      - name: "cors"

  ## Secure Auth routes
  - name: "auth-v1"
    url: "http://auth:9999/"
    routes:
      - name: "auth-v1"
        strip_path: true
        paths:
          - "/auth/v1/"
    plugins:
      - name: "cors"
      - name: "key-auth"
        config:
          hide_credentials: false
      - name: "acl"
        config:
          hide_groups_header: true
          allow:
            - "admin"
            - "anon"

  ## REST routes
  - name: "rest-v1"
    url: "http://rest:3000/"
    routes:
      - name: "rest-v1"
        strip_path: true
        paths:
          - "/rest/v1/"
    plugins:
      - name: "cors"
      - name: "key-auth"
        config:
          hide_credentials: false
      - name: "acl"
        config:
          hide_groups_header: true
          allow:
            - "admin"
            - "anon"

  ## Realtime routes
  - name: "realtime-v1"
    url: "http://realtime:4000/socket/"
    routes:
      - name: "realtime-v1"
        strip_path: true
        paths:
          - "/realtime/v1/"
    plugins:
      - name: "cors"
      - name: "key-auth"
        config:
          hide_credentials: false
      - name: "acl"
        config:
          hide_groups_header: true
          allow:
            - "admin"
            - "anon"

  ## Storage routes
  - name: "storage-v1"
    url: "http://storage:5000/"
    routes:
      - name: "storage-v1"
        strip_path: true
        paths:
          - "/storage/v1/"
    plugins:
      - name: "cors"
      - name: "key-auth"
        config:
          hide_credentials: false
      - name: "acl"
        config:
          hide_groups_header: true
          allow:
            - "admin"
            - "anon"

  ## Secure Storage routes (S3 protocol)
  - name: "storage-s3"
    url: "http://storage:5000/storage-s3-proxy/"
    routes:
      - name: "storage-s3"
        strip_path: true
        paths:
          - "/storage/v1/s3"
    plugins:
      - name: "cors"
      - name: "key-auth"
        config:
          hide_credentials: false
      - name: "acl"
        config:
          hide_groups_header: true
          allow:
            - "admin"
            - "anon"